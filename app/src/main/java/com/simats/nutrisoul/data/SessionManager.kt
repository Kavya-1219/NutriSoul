package com.simats.nutrisoul.data

import android.content.Context
import androidx.datastore.preferences.core.edit
import androidx.datastore.preferences.core.stringPreferencesKey
import androidx.datastore.preferences.preferencesDataStore
import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.map

private val Context.dataStore by preferencesDataStore("session_manager")

class SessionManager(private val context: Context) {

    private val KEY_CURRENT_USER_EMAIL = stringPreferencesKey("current_user_email")

    fun currentUserEmailFlow(): Flow<String?> = context.dataStore.data.map { it[KEY_CURRENT_USER_EMAIL] }

    suspend fun setCurrentUser(email: String) {
        context.dataStore.edit { it[KEY_CURRENT_USER_EMAIL] = email }
    }

    suspend fun clearCurrentUser() {
        context.dataStore.edit { it.remove(KEY_CURRENT_USER_EMAIL) }
    }
}
